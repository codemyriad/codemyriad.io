---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import Link from "@components/Link.astro";
// import { dateRange } from "@lib/utils";
import {
  SITE,
  HOME,
  //LINKS
} from "@consts";

import { ArrowRight } from "@lucide/astro";

const blog = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter((project) => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);

type ServiceEntry = {
  collection: "services";
  slug: string;
  data: {
    title: string;
    description: string;
    href?: string;
    draft?: boolean;
  };
};

const services = (
  (await getCollection("services" as any)) as ServiceEntry[]
).filter((service) => !service.data.draft);

const blogTitleColors = ["#F4C45C", "#F4915C"];

const formatDate = (date: Date) =>
  new Intl.DateTimeFormat("en-US", {
    month: "short",
    day: "2-digit",
    year: "numeric",
  }).format(date);
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <div class="space-y-24">
      <section id="hero" class="space-y-6">
        <h1 class="text-3xl font-medium leading-tight text-[#FAFAFA]">
          Operational systems for growing companies.
        </h1>
        <p class="text-lg text-[#7EC7FF]">
          We build the connective tissue between tools, teams, and workflows.
        </p>
      </section>

      <section id="services" class="space-y-6">
        <div class="grid sm:grid-cols-2 md:grid-cols-3">
          <div
            class="flex min-h-[170px] flex-col justify-between border border-white/10 p-6"
          >
            <h2 class="text-xl font-medium text-[#FAFAFA]/50">
              Areas of expertise
            </h2>
          </div>
          {
            services.map((service) => (
              // when ready change to <a> w/ href={service.data.href ?? "#contact"}
              <div class="group flex min-h-[170px] flex-col justify-between border border-white/10 bg-white/5 p-6">
                <div class="space-y-3">
                  <h3 class="text-xl font-medium text-[#FAFAFA]">
                    {service.data.title}
                  </h3>
                  <p class="text-base text-[#FAFAFA]/60">
                    {service.data.description}
                  </p>
                </div>
                {/* <div class="mt-6 flex items-center justify-end text-[#FAFAFA]/60 transition-colors duration-300 group-hover:text-[#FAFAFA]">
                  <span class="inline-flex size-8 items-center justify-center rounded-md border border-white/10 bg-white/5">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      class="size-4 stroke-2"
                      fill="none"
                      stroke="currentColor"
                    >
                      <line x1="5" y1="12" x2="19" y2="12" />
                      <polyline points="12 5 19 12 12 19" />
                    </svg>
                  </span>
                </div> */}
              </div>
            ))
          }
        </div>
      </section>

      <section id="projects" class="space-y-6">
        <div class="grid sm:grid-cols-2 md:grid-cols-3">
          <div
            class="flex min-h-[170px] flex-col justify-between border border-white/10 p-6"
          >
            <h2 class="text-xl font-medium text-[#FAFAFA]/50">Projects</h2>
          </div>
          {
            projects.map((project) => (
              <a
                href={`/${project.collection}/${project.slug}`}
                class="group flex min-h-[170px] flex-col justify-between border border-white/10 bg-white/5 p-6 transition-colors duration-300 hover:bg-white/10"
              >
                <div class="space-y-3">
                  <h3 class="text-xl font-medium text-[#FAFAFA]">
                    {project.data.title}
                  </h3>
                  <p class="text-base text-[#FAFAFA]/60">
                    {project.data.description}
                  </p>
                </div>
                <div class="mt-6 flex items-center justify-end text-[#FAFAFA]/60 transition-colors duration-300 group-hover:text-[#FAFAFA]">
                  <span class="inline-flex size-8 items-center justify-center rounded-md border border-white/10 bg-white/5">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 24 24"
                      class="size-4 stroke-2"
                      fill="none"
                      stroke="currentColor"
                    >
                      <line x1="5" y1="12" x2="19" y2="12" />
                      <polyline points="12 5 19 12 12 19" />
                    </svg>
                  </span>
                </div>
              </a>
            ))
          }
        </div>
      </section>

      <section id="blog" class="space-y-6">
        <div class="grid sm:grid-cols-2 md:grid-cols-3">
          <div
            class="flex min-h-[170px] flex-col justify-between border border-white/10 p-6"
          >
            <h2 class="text-xl font-medium text-[#FAFAFA]/50">Blog</h2>
          </div>
          {
            blog.map((post, index) => (
              <a
                href={`/${post.collection}/${post.slug}`}
                class="group flex min-h-[170px] flex-col justify-between border border-white/10 bg-white/5 p-6 transition-colors duration-300 hover:bg-white/10"
              >
                <div class="space-y-3">
                  <span class="text-sm text-[#FAFAFA]/40 inline-flex items-center gap-2 my-2">
                    Read
                    <ArrowRight size={14} />
                  </span>
                  <h3
                    class="text-xl font-medium"
                    style={`color: ${blogTitleColors[index % blogTitleColors.length]};`}
                  >
                    {post.data.title}
                  </h3>
                </div>
                <div class="mt-6 text-sm text-[#FAFAFA]/50">
                  {formatDate(post.data.date)} · {post.data.author}
                </div>
              </a>
            ))
          }
        </div>
      </section>

      <section id="contact">
        <div class="p-6 sm:p-10">
          <div class="space-y-6">
            <h2 class="text-xl font-medium text-[#FAFAFA]">
              Feeling stuck or unsure how to proceed?
            </h2>
            <p class="text-base font-regular text-[#FAFAFA]/60">
              With every project, we follow a
              <span class="italic">fixed-time, variable-scope</span>
              approach inspired by Basecamp’s
              <a
                href="https://basecamp.com/shapeup"
                target="_blank"
                rel="noreferrer"
                class="text-[#F4C45C] hover:text-[#F4C45C]/80"
              >
                Shape Up.
              </a> Book a short 30 minute call with us to help shape and reduce the
              scope of your problem until a sensible next step emerges. No obligation
              beyond that. You’ll leave with a clearer framing and a concrete next
              step, whether or not we continue working together.
            </p>
            <div
              class="flex flex-wrap items-center gap-3 font-regular text-base"
            >
              <a
                href="https://cal.eu/chris-de-sousa-fxpsnh/30min-shaping-call"
                target="_blank"
                rel="noreferrer"
                class="inline-flex items-center justify-center bg-[#FAFAFA] px-4 py-2 text-[#0A0A0A] transition-colors duration-300 hover:bg-white/80"
              >
                Start a conversation
              </a>
              <a
                href="mailto:team@codemyriad.io"
                class="text-[#FAFAFA]/60 hover:text-[#FAFAFA] hover:underline"
              >
                or drop us an
                <span class="text-[#F4C45C]">email</span>.
              </a>
            </div>
          </div>
        </div>
      </section>
    </div>
  </Container>
</PageLayout>
